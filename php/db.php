<?php

/**
 * Description of db
 *
 * @author Ameer <amirsanni@gmail.com>
 * @date 04-Jan-2017
 */
class db {
    protected $db;
    
    public function __construct($db) {
        $this->db = $db;
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    public function getAll($start, $end){
        try{
            $q = $this->db->prepare("SELECT id, title, description, start, end, allday
                FROM events
                WHERE
                DATE(end) >= ?
                AND
                DATE(start) <= ?");
        
            $q->execute([$start, $end]);

            if($q->rowCount()){
                return $q->fetchAll(PDO::FETCH_OBJ);
            }

            return FALSE;
        } 
        
        catch (Exception $ex) {
            return FALSE;//$ex->getMessage();
        }
    }

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    public function createEvent($data){
        try{
            $q = $this->db->prepare("INSERT INTO events (title, description, start, end, dateAdded) VALUES (?, ?, ?, ?, NOW())");
        
            $q->execute([
                $data['title'], $data['description'], $data['start'], $data['end']
            ]);

            if($q->rowCount()){
                return $this->db->lastInsertId();
            }

            return FALSE;
        } 
        
        catch (Exception $ex) {
            return FALSE;//$ex->getMessage();
        }
    }
}
